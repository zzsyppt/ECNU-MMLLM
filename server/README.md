# ECNU-MMLLM API

此项目提供了一个基于 FastAPI 的 RESTful API，允许用户上传心率数据，并返回多种心理状态评估指标。该服务使用预训练的大模型来处理心率变异性数据（HRV）并推测用户的心理状态。

## 文件结构

项目目录下的 `server.py` 文件为主程序文件，包含模型初始化、API 端点定义及相关功能。

## 项目依赖

### 必备库

见项目目录下的`requirements.txt`。
## 快速开始

### 1. 克隆仓库并安装依赖

```bash
git clone https://github.com/zzsyppt/ECNU-MMLLM
cd ECNU-MMLLM/server
pip install -r requirements.txt
```

### 2. 设置模型地址

在 `server.py` 文件中，找到以下代码行并指定您的模型路径：

```python
model_id = "your/path/to/ECNU_MMLLM/llama"
```

### 3. 启动服务

在 `server` 目录下，执行以下命令启动 API 服务器：

```bash
python server.py
```

默认情况下，API 将在 `http://0.0.0.0:6007` 运行。

## API 说明

### 根路径

**请求方法：** `GET`  
**路径：** `/`  
**返回：** 

```json
{
  "message": "欢迎使用多模态心理大模型的 API! 您在根路径。"
}
```

### 心率数据分析

**请求方法：** `POST`  
**路径：** `/v1/chat/completions`  
**请求体：** 包含用户的心率数据，格式为 `JSON` 对象，其中 `heart_rate_series` 为一个逗号分隔的心率数据字符串。

示例请求：

```json
{
  "heart_rate_series": "75,80,72,78,70"
}
```

**返回示例：**

```json
{
  "RMSSD": 23.5,
  "SDNN": 100.5,
  "pNN50": 5.0,
  "SN": 12.3,
  "心情状态": "放松",
  "心情颜色": "#ADD8E6",
  "总能量星级": 4,
  "放松度星级": 5,
  "压力指数星级": 2,
  "情绪稳定性星级": 5,
  "心理弹性星级": 4,
  "身心和谐度星级": 5,
  "综合得分": 85,
  "焦虑指数": 1,
  "疲劳指数": 2,
  "建议": "保持当前的放松状态，适度运动以增强身心健康。"
}
```

## 主要功能说明

上传心率数据，返回多种心理状态评估指标。

各指标的说明：

- **RMSSD**：均方根差，衡量短期心率变异性，主要反映副交感神经（迷走神经）活动水平。正常值为15-39，过低的 RMSSD 表示用户压力较大或情绪波动较大。
- **SDNN**：NN间隔标准差，反映总体心率变异性，受到交感和副交感神经活动的影响。正常值为102-180，过低的 SDNN 可能提示个体处于高压力状态或心理负担较大。
- **pNN50**：表示相邻心跳间隔差值大于 50 毫秒的比例。健康人群的 pNN50 值一般在 2% 到 8% 之间，较低的 pNN50 可能提示用户情绪不稳或处于紧张状态。
- **SN**：交感神经活动指数，衡量交感神经系统的活跃程度。SN 值超过 15 用户则可能压力或焦虑。
- **总能量**：反映整体生理活跃程度。总能量星级越高，表示用户的活力越强。
- **压力指数**：反映用户的心理压力水平，压力指数越高，用户可能处于较紧张状态。
- **放松度**：衡量用户的放松状态，放松度星级越高，表示用户更放松。
- **情绪稳定性**：评估用户的情绪是否稳定，情绪稳定性星级越高，表示情绪越稳定。
- **心情颜色**：该颜色最佳反映用户的心情状态。
- **心情状态**：直接描述用户的当前情绪。
- **心理弹性等级**：表示用户应对压力和逆境的能力，星级越高，心理弹性越强。
- **身心和谐度**：评估身体和心理的平衡状态，和谐度越高，表示身心更协调。
- **综合得分**：根据各项指标综合评估用户的心理健康状况，以100分记。
- **焦虑指数**：焦虑程度的测量，星级越高，表示焦虑程度越高。
- **疲劳指数**：用户的疲劳水平，疲劳指数越高，用户越表现出疲劳。
- **心率时长**：心率测量的总时长，单位为秒。

## 错误处理

如请求大模型生成的内容无法解析为 JSON，系统将自动重试多次，并返回 HTTP 状态码 `500` 以提示用户请求失败。

## 开发环境

- **Python 版本**：3.9
- **CUDA版本**：12.3
- **硬件要求**：此项目需要 GPU 支持以提升模型加载及处理效率
- **依赖库**：具体在项目根目录下 `requirements.txt` 中

## 贡献

如有兴趣参与项目开发或提交建议，请创建 Pull Request 或 Issues。

## 授权许可

此项目遵循 MIT 许可。